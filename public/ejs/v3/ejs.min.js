/*!
 * ejsv3 v3.2.6
 * (c) 2017-2019 
 * Released under the BSD-3-Clause License.
 * 
 */
!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.ejs=o()}(this,function(){"use strict";var e={ERROR_TYPE_APIOS:{code:1001,msg:"该API无法在当前OS下运行"},ERROR_TYPE_APIMODIFY:{code:1002,msg:"不允许更改JSSDK的API"},ERROR_TYPE_MODULEMODIFY:{code:1003,msg:"不允许更改JSSDK的模块"},ERROR_TYPE_APINOTEXIST:{code:1004,msg:"调用了不存在的api"},ERROR_TYPE_PROTONOTEXIST:{code:1005,msg:"调用错误，该组件api对应的proto不存在"},ERROR_TYPE_CUSTOMEAPINOTEXIST:{code:1006,msg:"非容器下无法调用自定义组件API"},ERROR_TYPE_EVENTNOTEXIST:{code:1007,msg:"对应的event事件在该环境下不存在"},ERROR_TYPE_INITVERSIONERROR:{code:1008,msg:"初始化版本号错误，请检查容器api的实现情况"},ERROR_TYPE_APINEEDHIGHNATIVEVERSION:{code:1009,msg:"当前API需要更高版本的容器支持"},ERROR_TYPE_READYMODIFY:{code:2001,msg:"ready回调不允许多次设置"},ERROR_TYPE_CONFIGMODIFY:{code:2002,msg:"config不允许多次调用"},ERROR_TYPE_CONFIGERROR:{code:2003,msg:"config校验错误"},ERROR_TYPE_VERSIONNOTSUPPORT:{code:2004,msg:"不支持当前容器版本，请确保容器与前端库版本匹配"},ERROR_TYPE_VERSIONNEEDUPGRADE:{code:2005,msg:"当前JSSDK库小于容器版本，请将前端库升级到最新版本"},ERROR_TYPE_NATIVE:{code:3e3,msg:"捕获到一处原生容器错误"},ERROR_TYPE_NATIVECALL:{code:3001,msg:"原生调用H5时参数不对"},ERROR_TYPE_UNKNOWN:{code:9999,msg:"未知错误"}};function O(e){console.error("[hybridJs error]: "+e)}function c(e){console.log("[hybridJs log]: "+e)}function o(e){var o=Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1];return"String"!==o&&"Number"!==o&&"Boolean"!==o&&"Undefined"!==o&&"Null"!==o}var d=function(){};function l(e){for(var r=e,o=arguments.length,n=Array(1<o?o-1:0),t=1;t<o;t++)n[t-1]=arguments[t];return n.forEach(function(o){o&&Object.keys(o).forEach(function(e){r[e]=o[e]})}),r}function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:6,r=0;return e.split("").filter(function(e){return(r+=/[\u4e00-\u9fa5]/.test(e)?2:1)<=o}).join("")}function t(e){return/^(http|https|ftp|\/\/)/g.test(e)?e:/(\.\/)|(\.\.\/)/.test(e)?(o=e,r=window.location,n=r.pathname,t=o.match(/\.\.\//g),i=t&&t.length||0,a=n.split("/"),s=a.slice(0,a.length-(i+1)).join("/")+"/"+o.replace(/\.+\//g,""),s=r.protocol+"//"+r.host+s):""+(c=window.location,d=c.pathname.split("/"),l=2<d.length,u=d[Number(l)]+"/",(c.protocol+"//"+c.host+"/"+u).replace(/[/]{2}$/,"/"))+e;var o,r,n,t,i,a,s,c,d,l,u}function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o=arguments[1],r=t(e),n="";return o&&Object.keys(o).forEach(function(e){-1===n.indexOf("?")&&-1===r.indexOf("?")?n+="?":n+="&",n+=e+"="+o[e]}),r+=n}function i(e){return e.replace(/^data.*,/,"")}function a(e){var d=e,l=d.globalError;function o(e,o){this.api=e,this.callback=o}o.prototype.walk=function(){var s=this,c=d.getPromise();return function(){for(var e=arguments.length,o=Array(e),r=0;r<e;r++)o[r]=arguments[r];var n=o;n[0]=n[0]||{},s.api.defaultParams&&n[0]instanceof Object&&Object.keys(s.api.defaultParams).forEach(function(e){void 0===n[0][e]&&(n[0][e]=s.api.defaultParams[e])});var t=void 0;if(s.callback&&(t=s.callback),s.api.support&&d.nativeVersion&&function(e,o){if("string"!=typeof e||"string"!=typeof o)throw new Error("version need to be string type");for(var r=e.split("."),n=o.split("."),t=Math.max(r.length,n.length),i=0;i<t;i+=1){var a=r[i]||0,s=n[i]||0;if(2===i&&(isNaN(+a)&&(a=a.slice(0,a.length-1)),isNaN(+s)&&(s=s.slice(0,s.length-1))),(s-=0)<(a-=0))return 1;if(a<s)return-1}return 0}(d.nativeVersion,s.api.support)<0){var i=s.api.namespace+"要求的容器版本至少为:"+s.api.support+"，当前容器版本："+d.nativeVersion+"，请升级",a={code:l.ERROR_TYPE_APINEEDHIGHNATIVEVERSION.code,msg:i};d.ui&&"function"==typeof d.ui.toast&&d.ui.toast(i),t=function(){var e=arguments.length,o=arguments.length<=0?void 0:arguments[0],r=void 0;c&&(r=arguments.length<=e-1?void 0:arguments[e-1]),o.error&&o.error(a),r&&r(a)}}return c?t&&new c(function(e,o){n=n.concat([e,o]),t.apply(s,n)}):t&&t.apply(s,n)}},o.prototype.dispose=function(){this.api=null,this.callback=null},d.Proxy=o}function s(e){var o=e;window.JSBridge={};var r=window.JSBridge,s=o.showError,c=o.globalError,a=o.os;o.JSBridge=r;var d="EpointJSBridge",l={},u={},f={},E=65536,R=[8193,8194,8195];function g(e,o){var r,n=d+"://"+e,t=void 0,i=void 0,a=void 0;return o.callbackId&&(t=o.callbackId,i=o.handlerName,a=o.data),n+=":"+t+"/"+i+"?"+(a=encodeURIComponent("string"!=typeof(r=a)?JSON.stringify(r):r))}function t(e,o,r){var n=o;if("function"==typeof r){var t=function e(o){return-1!==R.indexOf(o)?e(Math.floor(Math.random()*E)):o}(Math.floor(Math.random()*E));u[t]=r,n.callbackId=t}else n.callbackId=r;var i=g(e,n);a.ejs?a.ios?window.webkit.messageHandlers.WKWebViewJavascriptBridge.postMessage(i):window.top.prompt(i,""):O("浏览器中jsbridge无效,对应scheme:"+i)}r.registerHandler=function(e,o){l[e]=o},r.registerLongCallback=function(e,o){f[e]=o},r.getLongCallbackId=function(){return E-=1},r.callHandler=function(e,o,r,n){t(e,{handlerName:o,data:r},n)},r._handleMessageFromNative=function(a){setTimeout(function(){var e=void 0;try{"string"==typeof a?(e=decodeURIComponent(a),e=JSON.parse(e)):e=a}catch(e){return void s(c.ERROR_TYPE_NATIVECALL.code,c.ERROR_TYPE_NATIVECALL.msg)}var o=e.responseId,r=e.responseData,n=void 0;if(o)(n=(n=u[o])||f[o])&&n(r),delete u[o];else{var t=l[e.handlerName],i=e.data;t&&t(i)}})}}function u(E){return function(e,r,n){var t=e.success,i=e.error,a=e.dataFilter,o=e.proto,s=e.handlerName,c=e.isLongCb,d=e.isEvent,l=e.data,u=function(e){if(0===e.code)i&&i(e),!c&&n&&n(e);else{var o=e;a&&(o=a(o)),t&&t(o.result),!c&&r&&r(o.result)}};if(c){var f=E.getLongCallbackId();d&&(l.port=f),E.registerLongCallback(f,u),E.callHandler(o,s,l,f),r&&r()}else E.callHandler(o,s,l,u)}}function f(e){var R=e,g=R.Proxy,a=R.globalError,s=R.showError,c=R.os,O=R.callInner,p={},o={},v=["ejs","dd","h5"];function h(e,o,t,i){Object.defineProperty(e,o,{configurable:!0,enumerable:!0,get:function(){var e=p[t],o=e[function(e){for(var o=0,r=v.length;o<r;o+=1)if(e[v[o]])return v[o];return"h5"}(c)]||e.h5;if(o)return o.walk();var r=i.os?i.os.join("或"):'"非法"',n=i.namespace+"要求的os环境为:"+r;return s(a.ERROR_TYPE_APIOS.code,n),d},set:function(){s(a.ERROR_TYPE_APIMODIFY.code,a.ERROR_TYPE_APIMODIFY.msg)}})}function m(e){Object.defineProperty(R,e,{configurable:!0,enumerable:!0,get:function(){return o[e]||(o[e]={}),o[e]},set:function(){s(a.ERROR_TYPE_MODULEMODIFY.code,a.ERROR_TYPE_MODULEMODIFY.msg)}})}function t(e,o){if(o&&o.namespace){R[e]||m(e);var r=o,n=R[e],t=r.namespace;r.moduleName=e;var i,a,s=(a=n,(/[.]/.test(i=t)?i.replace(/[.][^.]+$/,"").split("."):[]).forEach(function(e){a[e]=a[e]||{},a=a[e]}),a),c=e+"."+r.namespace,d=/[.]/.test(t)?r.namespace.match(/[.][^.]+$/)[0].substr(1):t;p[c]||h(s,d,c,r);var l=r.runCode;!l&&O&&(l=O);var u=new g(r,l),f=p[c]||{},E={};p[c]={},v.forEach(function(e){r.os&&-1!==r.os.indexOf(e)?(p[c][e]=u,E[e]=!0):f[e]&&(p[c][e]=f[e],r.os&&r.os.push(e))}),Object.keys(E).forEach(function(e){f[e]&&f[e].dispose()})}}R.extendModule=function(e,o){if(o&&Array.isArray(o)){R[e]||m(e);for(var r=0,n=o.length;r<n;r+=1)t(e,o[r])}},R.extendApi=t}function E(e){var r=e,n=r.globalError,t=r.showError,o=r.JSBridge,i=void 0,a=!1,s=!1;r.config=function(e){if(r.os.dd&&window.dd)dd.config(e);else if(s)t(n.ERROR_TYPE_CONFIGMODIFY.code,n.ERROR_TYPE_CONFIGMODIFY.msg);else{s=!0;var o=function(){i?(c("ready!"),i()):a=!0};r.os.ejs?(r.runtime&&r.runtime.getEjsVersion?r.runtime.getEjsVersion({success:function(e){r.nativeVersion=e.version},error:function(){t(n.ERROR_TYPE_INITVERSIONERROR.code,n.ERROR_TYPE_INITVERSIONERROR.msg)}}):t(n.ERROR_TYPE_VERSIONNOTSUPPORT.code,n.ERROR_TYPE_VERSIONNOTSUPPORT.msg),r.event.config(l({success:function(){o()},error:function(e){var o=JSON.stringify(e);t(n.ERROR_TYPE_CONFIGERROR.code,o)}},e))):o()}},r.ready=function(e){r.os.dd&&window.dd?dd.ready(e):i?t(n.ERROR_TYPE_READYMODIFY.code,n.ERROR_TYPE_READYMODIFY.msg):(i=e,a&&(c("ready!"),a=!1,i()))},o.registerHandler("handleError",function(e){t(n.ERROR_TYPE_NATIVE.code,JSON.stringify(e))})}var R,g,p,v,h,m,P,_,I,T={};return function(e){this.os={};var o=e.match(/(Android);?[\s/]+([\d.]+)?/);o&&(this.os.android=!0,this.os.version=o[2],this.os.isBadAndroid=!/Chrome\/\d/.test(window.navigator.appVersion));var r=e.match(/(iPhone\sOS)\s([\d_]+)/);r&&(this.os.ios=!0,this.os.iphone=!0,this.os.version=r[2].replace(/_/g,"."));var n=e.match(/(iPad).*OS\s([\d_]+)/);n&&(this.os.ios=!0,this.os.ipad=!0,this.os.version=n[2].replace(/_/g,"."));var t=e.match(/EpointEJS/i);t&&(this.os.ejs=!0);var i=e.match(/DingTalk/i);i&&(this.os.dd=!0),t||i||(this.os.h5=!0)}.call(I=T,navigator.userAgent),(R=I).getPromise=function(){return R.Promise},R.setPromise=function(e){R.Promise=e},p=void 0,(g=I).showError=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"错误!";O("code:"+e+", msg:"+o),p&&p({code:e,message:o})},g.globalError=e,g.error=function(e){p=e,g.os.dd&&window.dd&&dd.error(p)},a(I),s(I),h=(v=I).os,m=u(v.JSBridge),v.callInner=function(e,o,r){var n=l({},e);n.success=void 0,n.error=void 0,n.dataFilter=void 0,h.ejs&&m({handlerName:this.api.namespace,data:n,proto:this.api.moduleName,success:e.success,error:e.error,dataFilter:e.dataFilter,isLongCb:this.api.isLongCb,isEvent:this.api.isEvent},o,r)},f(I),function(e){var t=e,i=u(t.JSBridge);function o(e){var o=t.getPromise(),r=e||{},n=function(e,o){i({handlerName:r.name,proto:r.mudule,data:r.data||{},success:r.success,error:r.error,isLongCb:r.isLongCb,isEvent:r.isEvent},e,o)};return o&&new o(n)||n()}t.callApi=o,t.callNativeApi=o}(I),E(I),_={},((P=I).innerUtil=_).extend=l,_.isObject=o,_.getFullPath=t,_.getFullUrlByParams=n,_.eclipseText=r,_.compatibleStringParamsToObject=function(e){var o=this,r=e;if(!_.isObject(r[0])){for(var n={},t=!!P.getPromise(),i=r.length,a=t?i-2:i,s=arguments.length,c=Array(1<s?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];for(var l=0;l<a;l+=1)void 0!==c[l]&&(n[c[l]]=r[l]);r[0]=n,t?(r[1]=r[i-2],r[2]=r[i-1]):(r[1]=void 0,r[2]=void 0)}return this.api&&this.api.defaultParams&&r[0]instanceof Object&&Object.keys(this.api.defaultParams).forEach(function(e){void 0===r[0][e]&&(r[0][e]=o.api.defaultParams[e])}),r},_.eclipseButtonsNumber=function(e,o){var r=e;if(r&&Array.isArray(r)){var n=r.length;if(o<n){var t=n-(n-o);r.length=t}}return r},_.getBase64NotUrl=i,T.version="3.2.6",T});